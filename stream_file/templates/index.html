<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stream storage</title>
<link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
</head>
<body>
{% block body %}

<header>
    <h1>üìÇ Stream Storage</h1>

    <div class="toolbar">
        <select id="sortSelect" class="btn" onchange="sortItems(this.value)">
            <option value="name">Name (A-Z)</option>
            <option value="date">Date Modified</option>
        </select>

        <button class="btn active" onclick="setView('list')" id="btnList" title="List View">
            ‚ò∞
        </button>
        <button class="btn" onclick="setView('grid')" id="btnGrid" title="Grid View">
            ‚äû
        </button>
    </div>
</header>

<div class="drive-container">
        {% for drive in drives %}
            <a href="/dir/{{ drive }}" class="drive-card active" onclick="selectDrive(event, this)">
                <div class="drive-icon">üíø</div>
                <div class="drive-info">
                    <span class="drive-name">Local Disk ({{ drive }})</span>
                    <span class="drive-label">System</span>
                </div>
            </a>
        {% endfor %}
</div>

<nav class="breadcrumbs">
    {% if path %}
        {% set path_=path.split('/') %}
        {% for i in  path_ %}

            <a href='/dir/{{ "/".join(path_[:loop.index]) }}'>{{ path_[:loop.index][loop.index0] }}</a>
            /
        {% endfor %}

    {% endif %}
</nav>

{%if files%}
  {% for key,dict in files.items()%}
    <div class="file-section">
       
                

                {%if key=="dir"%}
                            <h3 class="section-title">{{key.uppercase}}</h3>
                            <ul class="file-list" id="dirList">
                        {% for di in dict %}
                            {% for k,v in di.items() %}
                                {% if k=='path' %}
                                    {% set dir_=v.split('/')[-1:]|join('') %}
                                        <li class="list-item" data-name="{{ dir_ }}" data-timestamp="1700100000">
                                                        <div class="item-info">
                                                            <div class="item-icon">üìÅ</div>
                                                                <div class="item-details">
                                                                    <span class="item-name">{{ dir_ }}</span>
                                           

                                                                             {% if di.get('time_mod') %}
                                                                                        <span class="item-meta">{{ di.get('time_mod') }}</span>
                                                                             {% endif %}
                                                                </div>
                                                        </div>
                                                    <a href="/dir/{{ v }}" class="action-link">Open</a>
                                               
                                
                                        </li>
                                         {% endif %}
                            {% endfor %}
                        {% endfor %}

                                        
            </ul>
    </div>

    {% elif key=='files' %}


    <div class="file-section">
    <h3 class="section-title">{{key.uppercase}}</h3>
    <ul class="file-list" id="fileList">
                            {% for dit in dict %}
                                {% for k,v in dit.items() %}
                                    {% if k=='path' %}
                                        {% set file_=v.split('/')[-1:]|join('') %}
                                       <!-- THE FILE LIST ITEM -->
<li class="list-item" 
    data-name="{{ file_ }}" 
    data-time="{{ dit.get('time_mod', 'N/A') }}"
    data-size="{{ dit.get('size', 'N/A') }}"
    data-perm-r="{{ dit.get('perm', {}).get('r') }}"
    data-perm-w="{{ dit.get('perm', {}).get('w') }}"
    data-perm-e="{{ dit.get('perm', {}).get('e') }}">
    
    <div class="item-info">
        <div class="item-icon">üìÉ</div>
        <div class="item-details">
            <span class="item-name">{{ file_ }}</span>
            {% if dit.get('time_mod') %}
                <span class="item-meta">{{ dit.get('time_mod') }}</span>
            {% endif %}
        </div>
    </div>

    <!-- NEW ACTION GROUP -->
    <div class="action-group">
        <a href="/file/{{ v }}" class="action-link download">Download</a>
        <!-- The More Button -->
        <button type="button" class="btn-more" onclick="openFileDialog(this)">
            More
        </button>
    </div>
</li>

<!-- --- ADD THIS ONCE AT THE BOTTOM OF YOUR PAGE (OUTSIDE THE LOOP) --- -->
<dialog id="fileInfoDialog">
    <div class="dialog-header">
        <h3>File Details</h3>
        <button onclick="closeFileDialog()" class="close-btn">&times;</button>
    </div>
    <div class="dialog-content">
        <div class="detail-row">
            <strong>Name:</strong> <span id="modal-name"></span>
        </div>
        <div class="detail-row">
            <strong>Size:</strong> <span id="modal-size"></span>
        </div>
        <div class="detail-row">
            <strong>Modified:</strong> <span id="modal-time"></span>
        </div>
        <div class="detail-row">
            <strong>Permissions:</strong> 
            <span id="modal-perm"></span>
        </div>
    </div>
</dialog>

                                        {%endif%}
                                {%endfor%}
                            {%endfor%}
                    {% endif %}
            
     

                                 
                        </ul>

                </div>

   {% endfor %}
{%endif%}

{% endblock body %}
</body>
<script src="{{ url_for('static', path='/js/script.js') }}"></script>

</html>
